# 3x-ui-cert-generator

## Скрипт для генерации самоподписанного SSL-сертификата

---

### **О скрипте**

Этот скрипт автоматически создает **самоподписанный SSL-сертификат**, который привязывается к IP-адресу вашего сервера. Скрипт является универсальным и подходит для различных задач, где требуется защищённое соединение.

---

Этот скрипт — это инструмент, который автоматизирует процесс создания **самоподписанного SSL-сертификата**. Он использует ваш IP-адрес для создания уникального ключа и сертификата, чтобы обеспечить безопасное соединение.

---
### **Как работает скрипт**

1.  **Проверка/создание дирректории**:   
**Что делает этот код**  

 a.  **`TARGET_DIR="$HOME/certs"`**: Определяет целевую папку как `certs` внутри домашней директории пользователя. Это безопасный и универсальный путь.  
 b.  **`if [ ! -d "$TARGET_DIR" ]; then`**: Проверяет, **не существует ли** (`! -d`) эта папка.  
 c.  **`mkdir -p "$TARGET_DIR"`**: Создаёт папку. Флаг `-p` гарантирует, что команда не выдаст ошибку, если папка уже существует.  
 d.  **`cd "$TARGET_DIR" || { ... }`**: Пытается перейти в папку. Оператор `||` (ИЛИ) означает: если команда `cd` **не удалась** (выдала ошибку), выполни следующий блок (вывести сообщение об ошибке и завершить работу скрипта).  

2.  **Получение IP-адреса**: Скрипт обращается к внешнему сервису, чтобы автоматически определить **публичный IP-адрес** вашего сервера. Этот IP используется как основное имя для сертификата. Это удобно, если у вас нет доменного имени.
3.  **Генерация ключей**: Затем скрипт создает **приватный ключ** (`secret.key`). Этот ключ является секретным и используется для подписи сертификата. Он похож на ваш личный отпечаток. 
4.  **Создание сертификата**: Наконец, скрипт использует приватный ключ для создания **самоподписанного сертификата** (`cert.crt`). Этот сертификат содержит ваш IP-адрес и другую информацию, подтверждая, что именно ваш сервер обеспечивает безопасное соединение. Он действует 10 лет, так что вам не придется часто его обновлять.

---
### **Преимущества**

* **Простота и скорость**: Скрипт выполняет всю сложную работу за вас. Вместо того, чтобы вручную вводить множество команд, вы просто запускаете его.
* **Бесплатно**: Вам не нужно платить за сертификат. Это идеальное решение для тестов, внутренних сетей или личных проектов.
* **Автоматизация**: Скрипт сам находит ваш IP-адрес и сразу создает все необходимые файлы.
* **Универсальность**: Сертификат можно использовать для защиты любого сервиса, который поддерживает SSL/TLS-шифрование, включая веб-серверы, FTP и другие приложения.


---

### **Когда использовать этот скрипт**

Используйте этот скрипт, если:
* Вы хотите быстро и бесплатно создать сертификат для вашего сервера.
* Вы работаете в **тестовой** или внутренней среде, где не требуется доверие от внешних удостоверяющих центров.
* **Вы тестируете на локальной машине** (например, в VirtualBox, VMware) и хотите, чтобы сертификат работал внутри вашей локальной сети.
* Вы не используете доменное имя, а подключаетесь напрямую по IP-адресу.

---

### **Когда не использовать этот скрипт**

Не используйте этот скрипт, если:
* Вам нужен **доверенный сертификат** для публичного сайта. Самоподписанные сертификаты вызывают предупреждения в браузерах и приложениях.
* Вы планируете использовать **доменное имя**. В этом случае вам лучше получить сертификат от удостоверяющего центра, такого как **Let's Encrypt**.
* Вам нужен сертификат для коммерческого использования, где требуется высокий уровень доверия и гарантий.

---
## Используем скрипт (Применяем нужный скрипт)


**Для использования скрипта нужно выбрать один из нужных вариантов:**


**Для удалённого сервера:**

```bash
wget -qO- https://raw.githubusercontent.com/Svodnet/3x-ui-cert-generator/refs/heads/main/generate-cert-autodir.sh | bash
```

**Для локальной (домашней) виртуалки или домашнего отдельного ПК использованного в качестве сервера:**

```bash
wget -qO- https://raw.githubusercontent.com/Svodnet/3x-ui-cert-generator/refs/heads/main/generate-cert-autodir.sh | bash
```

Отлично! Думаю, что у Вас всё получилось!

---

## P.S. Важные дополнения ко всему прочему...

---
### **Предупреждения от браузеров и антивирусов**

Когда вы используете самоподписанный сертификат, браузеры и другие клиенты (например, приложения) не доверяют ему. Это происходит потому, что сертификат не подписан одним из известных и одобренных центров сертификации (CA). Вместо этого он подписан сам собой, что не даёт никаких гарантий его подлинности.

**В браузерах:** В результате браузер показывает пользователю **предупреждение безопасности**, которое может выглядеть так:
* "Подключение не защищено" (Your connection is not private)
* "Риск безопасности" (Security risk)

Чтобы продолжить, пользователь должен вручную подтвердить, что он принимает этот риск. Это нормально для тестовых или личных проектов, но **неприемлемо** для публичных сайтов.

**В антивирусах:** Некоторые антивирусные программы или брандмауэры также могут выдавать предупреждения. Они сканируют весь трафик и могут распознать, что сертификат является самоподписанным. Это может привести к тому, что антивирус заблокирует подключение или уведомит пользователя о потенциальной угрозе. Обычно это решается добавлением вашего сервера в **список исключений** антивируса.

-----

### **(I) Проблема с динамическим IP-адресом**

Если IP-адрес вашего сервера меняется (например, на виртуалке при перезагрузке), то старый сертификат, привязанный к старому IP, станет недействительным. Вам придётся **запускать скрипт заново** каждый раз, когда меняется IP.

Если вы знаете, что IP будет меняться, то есть решения:

  * **Ручной запуск:** Просто запускайте скрипт каждый раз после смены IP. Он автоматически определит новый адрес и создаст новый сертификат. Это самый простой способ, если IP меняется нечасто.
  * **Использование скрипта при каждом старте:** Вы можете добавить скрипт в автозагрузку системы. При каждой перезагрузке он будет автоматически генерировать новый сертификат с актуальным IP. Этот способ гарантирует, что у вас всегда будет рабочий сертификат.

Чтобы добавить скрипт в автозагрузку, вы можете использовать `crontab` с опцией `@reboot`. Например, команда `crontab -e` позволит вам добавить строку:

```
@reboot cd /home/user/cert && bash generate-cert.sh
```

Эта команда будет выполняться при каждой перезагрузке.

**Важно:** Для публичных проектов лучше использовать статический IP-адрес или доменное имя с бесплатным сервисом DNS, например, **Dynamic DNS**. Это позволит вам получать сертификаты от Let's Encrypt и избежать проблем с постоянной сменой IP.


---
### **(II) Решение проблемы с динамическим IP-адресом**

Если IP-адрес на вашей виртуалке или сервере меняется при перезагрузке, вы можете сделать его статическим на уровне вашей локальной сети.

**1. Фиксация IP-адреса через MAC-адрес**

Это самый надёжный способ, который работает как для реальной железки, так и для виртуальной машины.

* **Что это:** Вы настраиваете ваш домашний роутер так, чтобы он всегда выдавал вашей машине **один и тот же IP-адрес**. Для этого роутер использует уникальный идентификатор вашей сетевой карты — **MAC-адрес**. 
* **Как это работает:** Вы находите MAC-адрес вашей машины (в настройках сети) и вводите его в настройках роутера. В разделе **DHCP-сервера** или **IP Reservation** вы создаете правило, где указываете, что для этого MAC-адреса нужно всегда присваивать определенный IP-адрес.
* **Преимущества:** IP-адрес вашей машины больше не будет меняться, и сертификат, привязанный к нему, всегда будет актуальным.

**2. Настройка статического IP-адреса на самой машине**

Другой вариант — вручную настроить статический IP-адрес в самой операционной системе вашей виртуалки.

* **Как это работает:** Вы заходите в настройки сети и вместо "Получить IP-адрес автоматически" выбираете "Использовать следующий IP-адрес" (или аналогичную опцию). Там вы вручную вводите IP-адрес, маску подсети, шлюз и DNS-серверы.
* **Преимущества:** Вам не нужно заходить в настройки роутера.
* **Недостатки:** Есть риск конфликта IP-адресов, если DHCP-сервер роутера выдаст этот же адрес другому устройству.

Это наиболее удобный способ для тестовых или домашних проектов.
Использование этих методов избавит вас от необходимости постоянно запускать скрипт при каждой перезагрузке (II вариант избавит от I варианта с рутиной). 


